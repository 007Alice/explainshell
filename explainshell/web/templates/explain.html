{% extends "base.html" %}
{% block title %} - {{ matches[0].match|e }} {{ getargs|e }}{% endblock %}
	{% block content %}
            <div class="small-push"></div>
            <svg id="canvas">
            </svg>
            <div class="push"></div>
            <div id="command">
            {% import 'macros.html' as macros -%}
            {% for m in matches -%}
                {%- if m.name -%}
                    {{ macros.outputcommandexplain(m, getargs) }}
                {%- else -%}
                    <span class="{{ m.id }}">{{ m.match|e }}</span>
                {%- endif -%}{{ m.spaces|safe }}
            {%- endfor %}
            </div>
            <div style="height: 5px;"></div>
            <div style="height: 100px;"></div>
            <div>
                <table id="help" width="100%">
                    <tbody>
                        {% for text, id in helptext -%}
                        <tr>
                            <td>
                                <pre class="help-{{ id }}">{{ text|safe }}</pre>
                            </td>
                        </tr>
                        {%- endfor %}
                    </tbody>
                </table>
            </div>
{% endblock %}
{% block footer -%}
<div class="push"></div><div class="text-center"><small>
{% for m in matches if m.name %}
{% if loop.first %}source manpages: {% endif %}
<a href="http://manpages.ubuntu.com/manpages/precise/en/man{{ m.section }}/{{ m.source|e }}.html">{{ m.name|e }}</a>{% if not loop.last %},&nbsp;{% endif %}
{% endfor %}
</small></div>
{%- endblock %}
{% block js -%}
{% if config.DEBUG %}
        <script src="/static/js/d3.v3.min.js"></script>
{% else %}
        <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.1.6/d3.min.js"></script>
{%- endif %}
        <script type="text/javascript">
            currentgroup = initialize();
            drawgrouplines(currentgroup.commandselector, currentgroup.helpselector);

            // if we have more groups, show the prev/next buttons
            if (currentgroup.next) {
                var prev = $('<li><i class="icon-arrow-left icon-2" style="cursor: pointer;"></i><span></span></li>');
                prev.css({opacity: 0.5});
                var next = $('<li><i class="icon-arrow-right icon-2" style="cursor: pointer;"></i><span></span></li>');
                var prevnext = $('<ul class="unstyled" id="prevnext"><li>showing <u>shell syntax</u>, navigate:</li></ul>');
                prevnext.append(prev).append(next);
                $("#command").before(prevnext);

                var nextext = next.find("span"),
                    prevtext = prev.find("span"),
                    currentext = prevnext.find("u");

                nextext.text(" explain " + currentgroup.next.commandselector.first().text());

                prev.click(function() {
                    if (currentgroup.prev) {
                        console.log('moving to the previous group (%s), current group is %s', currentgroup.prev.name, currentgroup.name);
                        var oldgroup = currentgroup;
                        currentgroup = currentgroup.prev
                        if (currentgroup.name == 'shell')
                            currentext.text('shell syntax');
                        else
                            currentext.text(currentgroup.commandselector.first().text());

                        clear(oldgroup);
                        drawgrouplines(currentgroup.commandselector, currentgroup.helpselector);

                        if (!currentgroup.prev) {
                            console.log("new current group is the first group, disabling prev button");
                            prev.css({opacity: 0.5});
                            prevtext.text('');
                        }
                        else {
                            console.log("setting prev button text to new current group prev %s", currentgroup.prev.name);

                            if (currentgroup.prev.name == 'shell')
                                prevtext.text(" explain shell syntax");
                            else
                                prevtext.text(" explain " + currentgroup.prev.commandselector.first().text());
                        }

                        if (currentgroup.next) {
                            next.css({opacity: 1});
                            nextext.text(" explain " + currentgroup.next.commandselector.first().text());
                            console.log("setting next button text to new current group next %s", currentgroup.next.name);
                        }
                    }
                });

                next.click(function() {
                    if (currentgroup.next) {
                        console.log('moving to the next group (%s), current group is %s', currentgroup.next.name, currentgroup.name);
                        var oldgroup = currentgroup;
                        currentgroup = currentgroup.next
                        if (currentgroup.name == 'shell')
                            currentext.text('shell syntax');
                        else
                            currentext.text(currentgroup.commandselector.first().text());

                        clear(oldgroup);
                        drawgrouplines(currentgroup.commandselector, currentgroup.helpselector);

                        if (!currentgroup.next) {
                            console.log("new current group is the last group, disabling next button");
                            next.css({opacity: 0.5});
                            nextext.text('');
                        }
                        else {
                            console.log("setting next button text to new current group next %s", currentgroup.next.name);
                            nextext.text(" explain " + currentgroup.next.commandselector.first().text());
                        }

                        if (currentgroup.prev) {
                            prev.css({opacity: 1});
                            if (currentgroup.prev.name == 'shell')
                                prevtext.text(" explain shell syntax");
                            else
                                prevtext.text(" explain " + currentgroup.prev.commandselector.first().text());
                            console.log("setting prev button text to new current group prev %s", currentgroup.prev.name);
                        }
                    }
                });
            }


            $(window).resize(function(){
                clear(currentgroup);
                drawgrouplines(currentgroup.commandselector, currentgroup.helpselector);
            });
        </script>
{%- endblock %}
